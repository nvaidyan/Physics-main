<?php
// $Id$ 

/**
 * Implementation of hook_menu().
 */
function seminar_generate_menu() {
  $items = array();

  // Admin user pages
  $items['admin/generate/seminars'] = array(
    'title' => 'Generate a seminar series',
    'description' => 'Generate a seminar series',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('seminar_generate_form'),
    'access arguments' => array('administer nodes'),
  );

  return $items;
}
/**
 * Implementation of hook_form().
 */
 function seminar_generate_form() {
	  // Load up the CCK field for the seminar type per http://www.mugginsoft.com/content/getting-allowed-values-cck-field
      $sem_type = content_fields('field_seminar_type', 'seminar');
	  
	  $allowed_types = content_allowed_values($sem_type);
	  // for now, we're hard coding the nid to the desired semester to create. In the future, we can look up the nids from the 
	  // university time period content type and add a field to the form where users can select
	  
	  $university_time_period_nid = 1343;
	  
	  $form['seminarType'] = array(
		 '#type' => 'select',
		 '#title' => t('Select the seminar type to be generated'),
		 '#multiple' => FALSE,
		 '#description' => t('Pick the seminar type from a list of defined seminars in the system'),
		 '#options' => $allowed_types,
         '#default_value' => '',
	  );
	  
	  $form['seminarTime'] = array(
		 '#type' => 'hidden',
		 '#value' => $university_time_period_nid,
	  );
	  
	  $form['numSeminars'] = array(
		 '#type' => 'textfield',
		 '#title' => t('Select the number of seminars desired'),
	  );
	  
	  $form['generate'] = array(
		'#type' => 'submit',
		'#title' => t('This will generate seminars. Continue?'),
		'#value' => t('Do it!'),
	  );
	  return $form;
  }
/**
 * Implementation of hook_form_submit().
 */
 function seminar_generate_form_submit($form_id, &$form_state) {
		seminar_generate_makeSeminars($form_state);
	}
	
/**
   make seminars per http://www.stonemind.net/blog/2009/01/20/headless-drupal-using-drupals-api-to-batch-script-your-drupal-site/
 */
 function seminar_generate_makeSeminars($form_state) {
	$numSem = $form_state['values']['numSeminars'];
	$semType = $form_state['values']['seminarType'];
	$semTime = $form_state['values']['seminarTime'];
	
	for($i=0; $i<$numSem; $i++)
	{
	   $node = new StdClass();
	   $node->type = 'seminar';
       $node->status = 1;
       $node->promote = 1;
       $node->format = 2;
       $node->title = "TBA -- Generated by seminar_generate";
	   $node->body = "TBA";
	   $node->field_semester_reference[]['nid'] = $semTime;
	   $node->field_seminar_type[0]['value'] = $semType;
       $node = node_submit($node);
       if ($node->validated) {
         node_save($node);
       }
	}
 }
 ?>